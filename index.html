<!DOCTYPE html>
<html>

<head>
    <title>Razorpay Payment Integration</title>
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
</head>

<body>
    <button id="rzp-button">Pay</button>

    <script>
        document.getElementById('rzp-button').onclick = async function (e) {
            e.preventDefault();

            // Step 1: Create an order on the server
            const response = await fetch('https://imagerating-hq3k.onrender.com/order/createOrders', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    userId: "66d57e075817e4430aa31c0a",
                    planId: "66dfc9ccb9f6b1a18764fe05", amount: 1.99
                }) // Amount in INR
            });
            const order = await response.json();

            // Step 2: Initialize Razorpay Checkout
            const options = {
                key: "rzp_test_RmIqjjtJTjUcf4", // Replace with your key_id
                amount: order.amount,
                currency: order.currency,
                name: "Quiz General",
                description: "Test Transaction",
                order_id: order.id,
                handler: function (response) {
                    // Step 3: Verify the payment on the server
                    fetch('/verify-payment', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            razorpay_order_id: response.razorpay_order_id,
                            razorpay_payment_id: response.razorpay_payment_id,
                            razorpay_signature: response.razorpay_signature
                        })
                    }).then(res => res.json()).then(data => {
                        if (data.message === 'Payment verified successfully') {
                            alert('Payment successful');
                        } else {
                            alert('Payment verification failed');
                        }
                    });
                },
                prefill: {
                    name: "Customer Name",
                    email: "customer@example.com",
                    contact: "9999999999"
                },
                theme: {
                    color: "blue"
                }
            };

            const rzp1 = new Razorpay(options);
            rzp1.open();
        }
    </script>
</body>

</html>